{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
    .data-management-container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
    }
    
    .page-header {
        background: linear-gradient(135deg, #417690 0%, #2c5364 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        margin-bottom: 30px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .page-header h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        font-weight: 600;
    }
    
    .page-header p {
        margin: 0;
        opacity: 0.9;
        font-size: 14px;
    }
    
    .deletion-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }
    
    .deletion-card {
        background: white;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        border-left: 5px solid;
    }
    
    .deletion-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    
    .deletion-card.exam-data {
        border-left-color: #fd7e14;
    }
    
    .deletion-card.everything {
        border-left-color: #dc3545;
    }
    
    .card-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .card-icon {
        font-size: 36px;
        margin-right: 15px;
    }
    
    .card-title {
        flex: 1;
    }
    
    .card-title h3 {
        margin: 0 0 5px 0;
        font-size: 20px;
        color: #333;
    }
    
    .card-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .badge-warning {
        background: #fff3cd;
        color: #856404;
    }
    
    .badge-danger {
        background: #f8d7da;
        color: #721c24;
    }
    
    .card-content {
        margin-bottom: 20px;
    }
    
    .scope-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 15px;
    }
    
    .scope-title {
        font-weight: 600;
        color: #495057;
        margin-bottom: 10px;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .scope-list {
        margin: 0;
        padding-left: 20px;
        font-size: 14px;
        color: #6c757d;
        line-height: 1.8;
    }
    
    .scope-list li {
        margin-bottom: 5px;
    }
    
    .scope-list strong {
        color: #495057;
    }
    
    .delete-button {
        width: 100%;
        padding: 14px 20px;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .delete-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .delete-button:active {
        transform: translateY(0);
    }
    
    .btn-exam-data {
        background: linear-gradient(135deg, #fd7e14 0%, #e8590c 100%);
        color: white;
    }
    
    .btn-exam-data:hover {
        background: linear-gradient(135deg, #e8590c 0%, #d14d09 100%);
    }
    
    .btn-everything {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
    }
    
    .btn-everything:hover {
        background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
    }
    
    .info-section {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-left: 4px solid #ffc107;
        padding: 20px;
        border-radius: 6px;
        margin-bottom: 20px;
    }
    
    .info-section h4 {
        margin: 0 0 15px 0;
        color: #856404;
        font-size: 16px;
    }
    
    .info-list {
        margin: 0;
        padding-left: 20px;
        color: #856404;
        font-size: 14px;
        line-height: 1.8;
    }
    
    .cli-section {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 20px;
        border-radius: 6px;
        margin-top: 20px;
    }
    
    .cli-section h4 {
        margin: 0 0 15px 0;
        color: #3498db;
        font-size: 16px;
    }
    
    .cli-code {
        background: rgba(0,0,0,0.3);
        padding: 15px;
        border-radius: 4px;
        border-left: 3px solid #3498db;
        font-family: "Courier New", monospace;
        font-size: 13px;
        line-height: 1.6;
        color: #2ecc71;
    }
    
    .cli-comment {
        color: #f39c12;
        margin-bottom: 8px;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='deletedata' %}">Delete Data</a>
    &rsaquo; Data Management System
</div>
{% endblock %}

{% block content %}
<div class="data-management-container">
    
    <div class="page-header">
        <h1> Data Management System</h1>
        <p>Manage and clean system data with secure deletion operations</p>
    </div>

    <div class="deletion-cards">
        
        <!-- Delete Exam Data Card -->
        <div class="deletion-card exam-data">
            <div class="card-header">
                <div class="card-icon"></div>
                <div class="card-title">
                    <h3>Delete Exam Data</h3>
                    <span class="card-badge badge-warning">Restricted</span>
                </div>
            </div>
            
            <div class="card-content">
                <div class="scope-section">
                    <div class="scope-title">Operation Scope</div>
                    <ul class="scope-list">
                        <li><strong>Removes:</strong> Questions, Papers, Sessions, Answers</li>
                        <li><strong>Removes:</strong> Question Uploads & Activations</li>
                        <li><strong>Removes:</strong> All Exam-Related Data</li>
                        <li><strong>Preserves:</strong> User Registrations & Profiles</li>
                    </ul>
                </div>
            </div>
            
            <button onclick="deleteExamData()" class="delete-button btn-exam-data">
                Delete Exam Data
            </button>
        </div>

        <!-- Delete Everything Card -->
        <div class="deletion-card everything">
            <div class="card-header">
                <div class="card-icon"></div>
                <div class="card-title">
                    <h3>Delete Everything</h3>
                    <span class="card-badge badge-danger">Top Secret</span>
                </div>
            </div>
            
            <div class="card-content">
                <div class="scope-section">
                    <div class="scope-title">Operation Scope</div>
                    <ul class="scope-list">
                        <li><strong>Removes:</strong> All Questions & Papers</li>
                        <li><strong>Removes:</strong> All User Registrations</li>
                        <li><strong>Removes:</strong> All Candidate Profiles</li>
                        <li><strong>Preserves:</strong> Admin Accounts Only</li>
                    </ul>
                </div>
            </div>
            
            <button onclick="deleteEverything()" class="delete-button btn-everything">
                Delete Everything
            </button>
        </div>

    </div>

    <div class="info-section">
        <h4> Important Security Warnings</h4>
        <ul class="info-list">
            <li><strong>All operations are permanent and irreversible</strong></li>
            <li><strong>Ensure complete database backup before proceeding</strong></li>
            <li><strong>Debug logging is enabled for troubleshooting</strong></li>
            <li><strong>Operations may take several minutes to complete</strong></li>
        </ul>
    </div>

    <div class="cli-section">
        <h4> Command Line Interface</h4>
        <p style="margin-bottom: 15px; font-size: 14px;">For advanced operations and dry-run testing:</p>
        <div class="cli-code">
            <div class="cli-comment"># Test operations (dry-run mode)</div>
            python manage.py cleanup_exam_data --level=exam-data --dry-run --debug<br>
            python manage.py cleanup_exam_data --level=everything --dry-run --debug<br><br>
            
            <div class="cli-comment"># Execute operations</div>
            python manage.py cleanup_exam_data --level=exam-data --confirm --debug<br>
            python manage.py cleanup_exam_data --level=everything --confirm --debug<br><br>
            
            <div class="cli-comment"># Use batch file (Windows)</div>
            exam_admin.bat
        </div>
    </div>

</div>

<script>
function deleteExamData() {
    if (confirm(' WARNING: This will DELETE ALL EXAM-RELATED DATA\n\nThis includes:\n All Questions and Question Papers\n All Exam Sessions and Answers\n All Question Uploads and Activations\n All Exam-Related Files\n\nUSER REGISTRATIONS WILL BE PRESERVED\n\nThis action is PERMANENT and CANNOT be undone.\n\nDo you want to proceed?')) {
        if (confirm(' FINAL CONFIRMATION\n\nYou are about to execute a RESTRICTED OPERATION that will permanently delete all exam data.\n\nClick OK to proceed or Cancel to abort.')) {
            var confirmation = prompt(' SECURITY VERIFICATION\n\nTo confirm this critical operation, type exactly:\n\nDELETE EXAM DATA\n\n(Case sensitive)');
            if (confirmation === 'DELETE EXAM DATA') {
                showLoading('Executing secure deletion... Please wait.');
                window.location.href = '/admin/deletedata/examdatacleanup/clean-exam-data/';
            } else {
                alert(' OPERATION CANCELLED\n\nIncorrect confirmation text entered.\nOperation aborted for security.');
            }
        }
    }
}

function deleteEverything() {
    if (confirm(' MAXIMUM SECURITY ALERT\n\n CRITICAL WARNING: This operation will DELETE EVERYTHING\n\nThis includes:\n ALL Questions and Question Papers\n ALL User Registrations and Profiles\n ALL Candidate Data and Photos\n ALL Exam Sessions and Answers\n ALL System Data\n\nONLY ADMIN ACCOUNTS WILL BE PRESERVED\n\nThis action is PERMANENT and CANNOT be undone.\n\nDo you want to proceed?')) {
        if (confirm(' FINAL CONFIRMATION\n\nYou are about to execute a TOP SECRET OPERATION that will completely reset the entire system.\n\nThis is the MOST DESTRUCTIVE operation available.\n\nClick OK to proceed or Cancel to abort.')) {
            showLoading('Executing complete system reset... Please wait.');
            window.location.href = '/admin/deletedata/examdatacleanup/clean-everything/';
        }
    }
}

function showLoading(message) {
    document.body.style.cursor = 'wait';
    var buttons = document.querySelectorAll('button');
    buttons.forEach(btn => btn.disabled = true);
    
    var loadingDiv = document.createElement('div');
    loadingDiv.innerHTML = '<div style="text-align:center;"><div style="display:inline-block;width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:15px;"></div><br>' + message + '</div>';
    loadingDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;color:#333;padding:40px;border-radius:10px;z-index:9999;font-size:16px;box-shadow:0 10px 40px rgba(0,0,0,0.3);min-width:300px;';
    document.body.appendChild(loadingDiv);
    
    var style = document.createElement('style');
    style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
    document.head.appendChild(style);
}
</script>
{% endblock %}