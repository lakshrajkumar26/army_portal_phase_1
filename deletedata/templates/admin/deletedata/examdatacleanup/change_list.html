{% extends "admin/change_list.html" %}
{% load static %}

{% block content %}
<div class="cleanup-interface" style="padding: 20px;">
    
    <div class="cleanup-header" style="text-align: center; margin-bottom: 30px;">
        <h1 style="color: #333; margin-bottom: 10px;">üóÇÔ∏è Exam Data Cleanup</h1>
        <p style="color: #666; font-size: 16px;">Manage and clean exam-related data with different levels of cleanup</p>
    </div>

    <!-- Cleanup Options -->
    <div class="cleanup-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
        
        <!-- Clean Questions Only -->
        <div class="cleanup-card" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 15px;">üóÉÔ∏è</div>
            <h3 style="color: #17a2b8; margin-bottom: 15px;">Clean Questions & Papers</h3>
            <p style="color: #6c757d; margin-bottom: 20px; line-height: 1.5;">
                Delete all questions, question papers, exam sessions, and answers.<br>
                <strong>Preserves:</strong> User registrations and profiles
            </p>
            <button onclick="cleanQuestions()" 
                    style="background: #17a2b8; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;">
                Clean Questions & Papers
            </button>
        </div>

        <!-- Clean Exam Data -->
        <div class="cleanup-card" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 15px;">üßπ</div>
            <h3 style="color: #fd7e14; margin-bottom: 15px;">Clean All Exam Data</h3>
            <p style="color: #6c757d; margin-bottom: 20px; line-height: 1.5;">
                Delete all exam-related data including questions, papers, sessions, answers, and uploads.<br>
                <strong>Preserves:</strong> User registrations and profiles
            </p>
            <button onclick="cleanExamData()" 
                    style="background: #fd7e14; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;">
                Clean All Exam Data
            </button>
        </div>

        <!-- Clean Exam Slots -->
        <div class="cleanup-card" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 15px;">üé´</div>
            <h3 style="color: #28a745; margin-bottom: 15px;">Reset Exam Slots</h3>
            <p style="color: #6c757d; margin-bottom: 20px; line-height: 1.5;">
                Reset all exam slots for candidates.<br>
                <strong>Preserves:</strong> All other data including questions and user profiles
            </p>
            <button onclick="cleanExamSlots()" 
                    style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;">
                Reset Exam Slots
            </button>
        </div>

        <!-- Delete All Candidates -->
        <div class="cleanup-card" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 15px;">üë•</div>
            <h3 style="color: #dc3545; margin-bottom: 15px;">Delete All Candidates</h3>
            <p style="color: #6c757d; margin-bottom: 20px; line-height: 1.5;">
                Delete all candidate registrations and profiles.<br>
                <strong>Preserves:</strong> Questions, papers, and admin accounts
            </p>
            <button onclick="deleteAllCandidates()" 
                    style="background: #dc3545; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;">
                Delete All Candidates
            </button>
        </div>

    </div>

    <!-- Warning Section -->
    <div class="warning-section" style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è Important Notes</h4>
        <ul style="color: #856404; margin-bottom: 0; padding-left: 20px;">
            <li>All cleanup operations are <strong>permanent and cannot be undone</strong></li>
            <li>Make sure you have backups before performing any cleanup</li>
            <li>Questions cleanup will also delete all related exam sessions and answers</li>
            <li>Candidates cleanup will delete all user registrations but preserve questions</li>
            <li>Use the command line tool <code>exam_admin.bat</code> for dry-run options</li>
        </ul>
    </div>

    <!-- Command Line Alternative -->
    <div class="cli-section" style="background: #e9ecef; border: 1px solid #ced4da; padding: 15px; border-radius: 8px;">
        <h5 style="color: #495057; margin-bottom: 10px;">üíª Command Line Alternative</h5>
        <p style="color: #6c757d; margin-bottom: 10px; font-size: 14px;">
            For more control and dry-run options, use the command line:
        </p>
        <code style="background: #f8f9fa; padding: 8px; border-radius: 4px; display: block; font-family: monospace;">
            python manage.py cleanup_exam_data --level=questions --dry-run<br>
            python manage.py cleanup_exam_data --level=exam-data --confirm<br>
            python manage.py cleanup_exam_data --level=candidates --confirm<br>
            # Or use the batch file: exam_admin.bat
        </code>
    </div>

</div>

<script>
function cleanQuestions() {
    if (confirm('‚ö†Ô∏è WARNING: This will delete ALL questions, question papers, exam sessions, and answers.\n\nUser registrations will be preserved.\n\nThis action cannot be undone. Are you sure?')) {
        if (confirm('üî¥ FINAL CONFIRMATION: Delete all questions and related exam data?\n\nClick OK to proceed or Cancel to abort.')) {
            window.location.href = '{% url "admin:deletedata_examdatacleanup_clean_questions" %}';
        }
    }
}

function cleanExamData() {
    if (confirm('‚ö†Ô∏è WARNING: This will delete ALL exam-related data including questions, papers, sessions, answers, and uploads.\n\nUser registrations will be preserved.\n\nThis action cannot be undone. Are you sure?')) {
        if (confirm('üî¥ FINAL CONFIRMATION: Delete all exam data but keep user registrations?\n\nClick OK to proceed or Cancel to abort.')) {
            window.location.href = '{% url "admin:deletedata_examdatacleanup_clean_exam_data" %}';
        }
    }
}

function cleanExamSlots() {
    if (confirm('‚ö†Ô∏è This will reset all exam slots for all candidates.\n\nCandidates will need new slots assigned to take exams.\n\nAre you sure?')) {
        window.location.href = '{% url "admin:deletedata_examdatacleanup_clean_exam_slots" %}';
    }
}

function deleteAllCandidates() {
    if (confirm('‚ö†Ô∏è WARNING: This will delete ALL candidate registrations and profiles.\n\nThis includes all candidate data, photos, and user accounts.\n\nQuestions and exam data will be preserved.\n\nThis action cannot be undone. Are you sure?')) {
        if (confirm('üî¥ FINAL CONFIRMATION: Delete all candidate registrations?\n\nThis will remove all candidate profiles and user accounts (except admins).\n\nClick OK to proceed or Cancel to abort.')) {
            var confirmation = prompt('Type "DELETE CANDIDATES" to confirm:');
            if (confirmation === 'DELETE CANDIDATES') {
                window.location.href = '{% url "admin:deletedata_examdatacleanup_delete_candidates" %}';
            } else {
                alert('‚ùå Operation cancelled - incorrect confirmation text.');
            }
        }
    }
}
</script>

<style>
.cleanup-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.cleanup-card button:hover {
    opacity: 0.9;
    transform: translateY(-1px);
    transition: all 0.2s ease;
}
</style>

{% endblock %}